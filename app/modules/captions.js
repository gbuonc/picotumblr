define(["../../assets/js/iscroll","modules/tabs"],function(e,t){captionButtons=$("#tmblButtons"),handle=$("#detailCaption .handle"),detailCaption=$("#detailCaption"),captionContent=$("#captionContent > div"),pin=$("#pin"),pin.on("click",function(){$(this).toggleClass("pinned"),n.isPinned=n.isPinned===!0?!1:!0}),handle.on("click",function(){n.slide.toggle()});var n={isPinned:!0,pattern:/(http:\/\/).*(?=.tumblr)/,init:function(){return n.scrollable=new iScroll("captionContent"),n.slide=new slideInMenu("detailCaption",!1,"bottom")},update:function(){var e=$(".swipeview-active .caption").html();captionButtons.html("");if(e){tumblrRef=e.split(".com");var r="",s=tumblrRef.length;for(i=0;i<s;i++)n.pattern.test(tumblrRef[i])&&(tumblrRef[i]=n.pattern.exec(tumblrRef[i]),tumblrRef[i]=tumblrRef[i][0].replace("http://",""),r+='<a href="#/'+tumblrRef[i]+'">'+tumblrRef[i]+"</a>",tumblr.getData(tumblrRef[i],{showErrors:!1},function(e){t.add(e,"rels")}));captionButtons.html(r)}captionContent.html("").append(e),setTimeout(function(){n.scrollable.refresh()},0);var o=detailCaption.height();captionButtons.css({top:"auto",bottom:o+"px"}),detailCaption.css({bottom:"-"+o+"px"}),n.isPinned?e?(n.slide.open(),handle.addClass("visible")):(n.slide.close(),handle.removeClass("visible")):e?handle.addClass("visible"):handle.removeClass("visible")},close:function(){n.slide.close()},closeWithoutAnimation:function(){n.slide.closeWithoutAnimation()}};return n})