define(["../../assets/js/text!templates/hlist.tpl","../../assets/js/handlebars","../../assets/js/iscroll","../../assets/js/lawnchair","modules/app"],function(e,t,n,r,i){var s=$("#favs .scrollWrapper"),o=$("#topBar .btnFav"),u=$(e).html(),a=Handlebars.compile(u),f={scrollable:new iScroll("favs"),init:function(){i.storage.get("tme",function(e){e=e.value,i.favs.sites=e.favs})},isFav:function(e){var t=$(i.favs.sites).pluck("id"),n=t.indexOf(e)!==-1;return n?t.indexOf(e):!1},setButton:function(e,t){var n=f.isFav(e);t.off("click"),n===!1?t.html("add").on("click",function(){f.add(e,tumblr.sites[e],t)}):t.html("remove").on("click",function(){f.remove(e,n,t)})},add:function(e,t,n){tmpObj={id:e,title:t.siteInfo.title,av:t.siteInfo.avatar},i.favs.sites.unshift(tmpObj),i.storage.get("tme",function(e){e=e.value,e.favs=i.favs.sites,i.storage.save({key:"tme",value:e})}),i.showMessage(tmpObj.id+" added to favs!"),f.setButton(e,n)},remove:function(e,t,n){i.favs.sites.splice(t,1),i.storage.get("tme",function(e){e=e.value,e.favs=i.favs.sites,i.storage.save({key:"tme",value:e})}),s.find("#fav_"+e).remove(),i.showMessage("This site has been removed!"),f.setButton(e,n)},updateHpList:function(){var e={warning:"Sorry, no sites added to favs yet!",listItem:i.favs.sites};s.html(a(e)),setTimeout(function(){f.scrollable.refresh()},0)},reset:function(){i.favs.sites.length=0,i.storage.get("tme",function(e){e=e.value,e.favs=i.favs.sites,i.storage.save({key:"tme",value:e})}),f.updateHpList()}};return f})