define(["../../assets/js/text!templates/hlist.tpl","../../assets/js/handlebars","../../assets/js/iscroll","../../assets/js/lawnchair","modules/app"],function(e,t,n,r,i){var s=$("#history .scrollWrapper"),o=$("#history button");o.live("click",function(){var e=$(this).attr("data-target");l.clearItem(e)});var u=$("#recentTab .btnClear");u.live("click",function(){l.reset()});var a=$(e).html(),f=Handlebars.compile(a),l={scrollable:new iScroll("history"),init:function(){i.storage.get("tme",function(e){e=e.value,l.sites=e.history})},save:function(e,t){var n=$(l.sites).pluck("id"),r=n.indexOf(e)===-1;if(r){tmpObj={id:e,title:t.siteInfo.title,av:t.siteInfo.avatar},l.sites.unshift(tmpObj);var i=l.sites.length;i>=16&&l.sites.pop(),l.store()}},clearItem:function(e){var t=$(l.sites).pluck("id"),n=t.indexOf(e);l.sites.remove(n),l.store();var r=s.find("li").eq(n);r.animate({opacity:0},300,"ease-in-out",function(){s.find("li").each(function(){var e=$(this).index();e>n&&$(this).animate({left:"-138px"},300,"ease-out")}),setTimeout(function(){r.remove(),l.updateHpList()},800)})},updateHpList:function(){l.sites.length===0?u.hide():u.show();var e={warning:"Sorry, no recent sites yet!",listItem:l.sites};s.html(f(e)),setTimeout(function(){l.scrollable.refresh()},0)},reset:function(){var e=confirm("Really delete all recent sites?");e&&(l.sites.length=0,l.store(),l.updateHpList(),tumblr.sites={})},store:function(){i.storage.get("tme",function(e){e=e.value,e.history=l.sites,i.storage.save({key:"tme",value:e})})}};return l})