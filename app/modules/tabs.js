define(["../../assets/js/text!templates/hlist.tpl","../../assets/js/handlebars","../../assets/js/iscroll","../../assets/js/lawnchair","modules/app","modules/tumblr"],function(e,t,n,r,i,s){var o=$(e).html(),u=Handlebars.compile(o),a={list:["history","favs","rels"],hpTabs:{history:{$hpList:$("#history .scrollWrapper"),$clearBtn:$("#history button"),$resetBtn:$("#recentTab .btnClear"),confirmMsg:"Really delete all recent sites?",warning:"Sorry, your history is empty!"},favs:{$hpList:$("#favs .scrollWrapper"),$clearBtn:$("#favs button"),$resetBtn:$("#favsTab .btnClear"),btnFav:$("#topBar .btnFav"),confirmMsg:"Really delete all favourites sites?",warning:"Sorry, no favs added yet!"},rels:{$hpList:$("#rels .scrollWrapper"),$clearBtn:$("#rels button"),$resetBtn:$("#exploreTab .btnClear"),confirmMsg:"Really delete all explore sites?",warning:"Sorry, your explore directory is empty!"}},init:function(){$.each(a.list,function(e,t){i.storage.get(i.config.storageId,function(e){e=e.value,i[t].sites=e[t]}),a.hpTabs[t].$clearBtn.live("click",function(){var e=$(this).attr("data-target");a.remove(e,t)}),a.hpTabs[t].$resetBtn.live("click",function(){a.reset(t)}),a.hpTabs[t].scrollable=new iScroll(t)});var e=$("#hpTabs > ul li"),t=$("#hpTabs");$(e).on("click",function(){var n=$(this).attr("id");t.attr("class",n),e.removeClass("active"),$(this).addClass("active")}),a.writeTabs()},posInArray:function(e,t){var n=$(i[t].sites).pluck("id");return n.indexOf(e)},add:function(e,t,n){var r=a.posInArray(e,t);if(r===-1){var o=s.sites[e];tmpObj={id:e,title:o.siteInfo.title,av:o.siteInfo.avatar,updated:o.siteInfo.updated,tp:o.siteInfo.totalPictures},i[t].sites.unshift(tmpObj);if(t!=="favs"){var u=i[t].sites.length;u>=21&&i[t].sites.pop()}a.store(t),a.updateHpList(t),n&&n()}},remove:function(e,t,n){var r=a.posInArray(e,t);i[t].sites.remove(r),a.store(t);var s=a.hpTabs[t].$hpList.find("li").eq(r);s.animate({opacity:0},300,"ease-in-out",function(){a.hpTabs[t].$hpList.find("li").each(function(){var e=$(this).index();e>r&&$(this).animate({left:"-138px"},300,"ease-out")}),setTimeout(function(){s.remove(),a.updateHpList(t)},800)}),n&&n()},writeTabs:function(){$.each(a.list,function(e,t){a.updateHpList(t)})},updateScrollable:function(){$.each(a.list,function(e,t){a.hpTabs[t].scrollable.refresh()})},updateHpList:function(e){i[e].sites.length===0?a.hpTabs[e].$resetBtn.addClass("disabled"):a.hpTabs[e].$resetBtn.removeClass("disabled");var t={warning:a.hpTabs[e].warning,listItem:i[e].sites};a.hpTabs[e].$hpList.html(u(t)),setTimeout(function(){a.hpTabs[e].scrollable.refresh()},0)},reset:function(e){var t=confirm(a.hpTabs[e].confirmMsg);t&&(i[e].sites.length=0,a.store(e),a.updateHpList(e),e==="history"&&(s.sites={}))},store:function(e){i.storage.get(i.config.storageId,function(t){t=t.value,t[e]=i[e].sites,i.storage.save({key:i.config.storageId,value:t})})}};return a})