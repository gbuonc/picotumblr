/*!
 * SwipeView v0.11 ~ Copyright (c) 2011 Matteo Spinelli, http://cubiq.org
 * Vertical mod by Per-Olov Jernberg, http://possan.se
 * Released under MIT license, http://cubiq.org/license
 */

var SwipeView=function(){var e="ontouchstart"in window,t="onorientationchange"in window?"orientationchange":"resize",n=e?"touchstart":"mousedown",r=e?"touchmove":"mousemove",s=e?"touchend":"mouseup",o=e?"touchcancel":"mouseup",u=function(e,t){this.__construct(e,t)};return u.prototype={currentMasterPage:1,pos:0,page:0,pageIndex:0,customEvents:[],onFlip:function(e){this.wrapper.addEventListener("swipeview-flip",e,!1),this.customEvents.push(["flip",e])},onMoveOut:function(e){this.wrapper.addEventListener("swipeview-moveout",e,!1),this.customEvents.push(["moveout",e])},onMoveIn:function(e){this.wrapper.addEventListener("swipeview-movein",e,!1),this.customEvents.push(["movein",e])},onTouchStart:function(e){this.wrapper.addEventListener("swipeview-touchstart",e,!1),this.customEvents.push(["touchstart",e])},destroy:function(){var e,i;while(this.customEvents.length)this.wrapper.removeEventListener("swipeview-"+this.customEvents[0][0],this.customEvents[0][1],!1),this.customEvents.shift();this.customEvents=[],window.removeEventListener(t,this,!1),this.wrapper.removeEventListener(n,this,!1),this.wrapper.removeEventListener(r,this,!1),this.wrapper.removeEventListener(s,this,!1),this.slider.removeEventListener("webkitTransitionEnd",this,!1)},refreshSize:function(){this.wrapperSize=this.options.vertical?this.wrapper.clientHeight:this.wrapper.clientWidth,this.pageSize=this.wrapperSize,this.maxPos=-this.options.numberOfPages*this.pageSize+this.wrapperSize,this.snapThreshold=this.options.snapThreshold===null?Math.round(this.pageSize*.15):/%/.test(this.options.snapThreshold)?Math.round(this.pageSize*this.options.snapThreshold.replace("%","")/100):this.options.snapThreshold},updatePageCount:function(e){this.options.numberOfPages=e,this.maxPos=-this.options.numberOfPages*this.pageSize+this.wrapperSize},goToPage:function(e){this.refreshSize();if(this.options.dynamic){this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"");for(var t=0;t<3;t++)className=this.masterPages[t].className,/(^|\s)swipeview-loading(\s|$)/.test(className)||(this.masterPages[t].className=className?className+" swipeview-loading":"swipeview-loading")}e=e<0?0:e>this.options.numberOfPages-1?this.options.numberOfPages-1:e,this.page=e,this.pageIndex=e,this.slider.style.webkitTransitionDuration="0",this.__pos(-e*this.pageSize),this.options.dynamic?this.currentMasterPage=this.page+1-Math.floor((this.page+1)/3)*3:this.currentMasterPage=this.page;if(this.options.dynamic){this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className+" swipeview-active";var n,r,i;this.currentMasterPage==0?(n=this.masterPages[2],r=this.masterPages[0],i=this.masterPages[1]):this.currentMasterPage==1?(n=this.masterPages[0],r=this.masterPages[1],i=this.masterPages[2]):(n=this.masterPages[1],r=this.masterPages[2],i=this.masterPages[0]);var s=this.page==0?this.options.numberOfPages-1:this.page-1,o=this.page==this.options.numberOfPages-1?0:this.page+1;this.__movePage(n,s,this.page*100-100),this.__movePage(r,this.page,this.page*100),this.__movePage(i,o,this.page*100+100)}this.__flip()},gotoPage:this.goToPage,next:function(){if(!this.options.loop&&this.pos==this.maxPos)return;this.direction=-1,this.pos-=1,this.__checkPosition()},prev:function(){if(!this.options.loop&&this.pos==0)return;this.direction=1,this.pos+=1,this.__checkPosition()},handleEvent:function(e){switch(e.type){case n:this.__start(e);break;case r:this.__move(e);break;case o:case s:this.__end(e);break;case t:this.__resize();break;case"webkitTransitionEnd":e.target==this.slider&&!this.options.hastyPageFlip&&this.__flip()}},__construct:function(e,i){var o,u,a,f;this.wrapper=typeof e=="string"?document.querySelector(e):e,this.options={text:null,numberOfPages:3,snapThreshold:null,hastyPageFlip:!1,vertical:!1,loop:!0,dynamic:!0,createPage:null,updatePage:null,beforeShow:null,positionPage:null};for(o in i)this.options[o]=i[o];this.wrapper.style.position="relative",this.topmult=this.options.vertical?1:0,this.leftmult=this.options.vertical?0:1,this.masterPages=[],u=document.createElement("div"),u.id="swipeview-slider",u.style.cssText="position:relative;top:0;left:0;height:100%;width:100%;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);-webkit-transition-timining-function:ease-out",this.wrapper.appendChild(u),this.slider=u,this.refreshSize();if(this.options.dynamic){for(o=-1;o<2;o++){u=document.createElement("div"),u.id="swipeview-masterpage-"+(o+1);var l=this.leftmult*o*100+"%",c=this.topmult*o*100+"%";u.style.cssText="-webkit-transform:translateZ(0);position:absolute;height:100%;width:100%;left:"+l+";top:"+c,u.dataset||(u.dataset={}),f=o==-1?this.options.numberOfPages-1:o,u.dataset.pageIndex=f,u.dataset.upcomingPageIndex=f,!this.options.loop&&o==-1&&(u.style.visibility=""),this.slider.appendChild(u),this.masterPages.push(u),this.options.createPage!=null&&this.options.createPage(u,f),o==0&&this.options.beforeShow!=null&&this.options.beforeShow(u,f)}a=this.masterPages[1].className,this.masterPages[1].className=a?a+" swipeview-active":"swipeview-active"}else for(o=0;o<this.options.numberOfPages;o++){u=document.createElement("div"),u.id="swipeview-masterpage-"+o;var l=this.leftmult*o*100+"%",c=this.topmult*o*100+"%";u.style.cssText="-webkit-transform:translateZ(0);position:absolute;height:100%;width:100%;left:"+l+";top:"+c,u.dataset||(u.dataset={}),u.dataset.pageIndex=o,u.dataset.upcomingPageIndex=o,this.slider.appendChild(u),this.masterPages.push(u),this.options.createPage!=null&&this.options.createPage(u,o),o==0&&this.options.beforeShow!=null&&this.options.beforeShow(u,o)}window.addEventListener(t,this,!1),this.wrapper.addEventListener(n,this,!1),this.wrapper.addEventListener(r,this,!1),this.wrapper.addEventListener(s,this,!1),this.slider.addEventListener("webkitTransitionEnd",this,!1)},__movePage:function(e,t,n){var r=this.topmult*n,i=this.leftmult*n;if(this.options.positionPage!=null){this.options.positionPage(e,t,r,i);return}e.dataset.upcomingPageIndex=t,e.style.top=r+"%",e.style.left=i+"%"},__pos:function(e){this.pos=e,this.options.vertical?this.slider.style.webkitTransform="translate3d(0,"+e+"px,0)":this.slider.style.webkitTransform="translate3d("+e+"px,0,0)"},__resize:function(){this.refreshSize(),this.slider.style.webkitTransitionDuration="0",this.__pos(-this.page*this.pageSize)},__start:function(t){if(this.initiated)return;var n=e?t.touches[0]:t;this.initiated=!0,this.moved=!1,this.thresholdExceeded=!1,this.startX=n.pageX,this.startY=n.pageY,this.pointX=n.pageX,this.pointY=n.pageY,this.stepsX=0,this.stepsY=0,this.direction=0,this.directionLocked=!1,this.slider.style.webkitTransitionDuration="0",this.__event("touchstart");if(this.options.beforeShow!=null){var r,i;this.options.dynamic?this.currentMasterPage==0?(r=this.masterPages[2],i=this.masterPages[1]):this.currentMasterPage==1?(r=this.masterPages[0],i=this.masterPages[2]):(r=this.masterPages[1],i=this.masterPages[0]):(this.page>1&&(r=this.masterPages[this.page-1]),this.page<this.options.numberOfPages-1&&(i=this.masterPages[this.page+1])),r!=null&&this.options.beforeShow(r,r.dataset.pageIndex),i!=null&&this.options.beforeShow(i,i.dataset.pageIndex)}},__move:function(t){if(!this.initiated)return;var n=e?t.touches[0]:t,r=n.pageX-this.pointX,i=n.pageY-this.pointY,s=this.options.vertical?i:r,o=this.pos+s,u=this.options.vertical?Math.abs(n.pageY-this.startY):Math.abs(n.pageX-this.startX);this.moved=!0,this.pointX=n.pageX,this.pointY=n.pageY,this.direction=s>0?1:s<0?-1:0,this.stepsX+=Math.abs(r),this.stepsY+=Math.abs(i);if(this.stepsX<10&&this.stepsY<10)return;if(!this.directionLocked)if(this.options.vertical&&this.stepsX>this.stepsY||!this.options.vertical&&this.stepsY>this.stepsX){this.initiated=!1;return}t.preventDefault(),this.directionLocked=!0,!this.options.loop&&(o>0||o<this.maxPos)&&(o=this.pos+s/2),!this.thresholdExceeded&&u>=this.snapThreshold?(this.thresholdExceeded=!0,this.__event("moveout")):this.thresholdExceeded&&u<this.snapThreshold&&(this.thresholdExceeded=!1,this.__event("movein")),this.__pos(o)},__end:function(t){if(!this.initiated)return;var n=e?t.changedTouches[0]:t,r=this.options.vertical?Math.abs(n.pageY-this.startY):Math.abs(n.pageX-this.startX);this.initiated=!1;if(!this.moved)return;!this.options.loop&&(this.pos>0||this.pos<this.maxPos)&&(r=0,this.__event("movein"));if(r<this.snapThreshold){this.slider.style.webkitTransitionDuration="300ms",this.__pos(-this.page*this.pageSize);return}this.__checkPosition()},__checkPosition:function(){var e,t,n;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"");var r=this.direction>0;if(r){this.direction="backward",this.page=-Math.ceil(this.pos/this.pageSize),this.options.dynamic?this.currentMasterPage=this.page+1-Math.floor((this.page+1)/3)*3:this.currentMasterPage=this.page,this.pageIndex=this.pageIndex==0?this.options.numberOfPages-1:this.pageIndex-1;if(this.options.dynamic){e=this.currentMasterPage-1,e=e<0?2:e;var i=this.page*100-100;this.masterPages[e].style.top=this.topmult*i+"%",this.masterPages[e].style.left=this.leftmult*i+"%"}t=this.page-1}else{this.direction="forward",this.page=-Math.floor(this.pos/this.pageSize),this.options.dynamic?this.currentMasterPage=this.page+1-Math.floor((this.page+1)/3)*3:this.currentMasterPage=this.page,this.pageIndex=this.pageIndex==this.options.numberOfPages-1?0:this.pageIndex+1;if(this.options.dynamic){e=this.currentMasterPage+1,e=e>2?0:e;var s=this.page*100+100;this.masterPages[e].style.top=this.topmult*s+"%",this.masterPages[e].style.left=this.leftmult*s+"%"}t=this.page+1}n=this.masterPages[this.currentMasterPage].className,/(^|\s)swipeview-active(\s|$)/.test(n)||(this.masterPages[this.currentMasterPage].className=n?n+" swipeview-active":"swipeview-active"),this.options.dynamic&&(n=this.masterPages[e].className,/(^|\s)swipeview-loading(\s|$)/.test(n)||(this.masterPages[e].className=n?n+" swipeview-loading":"swipeview-loading"),t-=Math.floor(t/this.options.numberOfPages)*this.options.numberOfPages,this.masterPages[e].dataset.upcomingPageIndex=t),this.slider.style.webkitTransitionDuration="500ms";var o=-this.page*this.pageSize;this.options.dynamic&&!this.options.loop,this.pos==o?this.__flip():(this.__pos(o),this.options.hastyPageFlip&&this.__flip())},__flip:function(){this.__event("flip");if(this.options.dynamic)for(var e=0;e<3;e++)this.masterPages[e].className=this.masterPages[e].className.replace(/(^|\s)swipeview-loading(\s|$)/,""),this.masterPages[e].dataset.pageIndex=this.masterPages[e].dataset.upcomingPageIndex},__event:function(e,t){var n=document.createEvent("Event");n.initEvent("swipeview-"+e,!0,!0);if(typeof t!="undefined")for(i in t)n[i]=t[i];this.wrapper.dispatchEvent(n)}},u}()